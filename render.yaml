services:
  # PostgreSQL Database
  - type: pserv
    name: callcenterai-db
    plan: free
    databaseName: callcenterai
    databaseUser: callcenterai

  # API Backend (.NET)
  - type: web
    name: callcenterai-api
    env: docker
    rootDir: CallCenterAI.Api
    dockerfilePath: Dockerfile
    plan: free
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: PORT
        value: 8080
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: callcenterai-db
          property: connectionString
      - key: OpenAI__ApiKey
        sync: false
      - key: OpenAI__Model
        value: gpt-4o-mini
      - key: SpeechService__BaseUrl
        fromService:
          type: web
          name: callcenterai-speech
          property: host

  # Speech Service (Python/Whisper)
  - type: web
    name: callcenterai-speech
    env: docker
    rootDir: CallCenterAi.speech
    dockerfilePath: Dockerfile
    plan: starter
    envVars:
      - key: PORT
        value: 8080

  # Frontend (React)
  - type: web
    name: callcenterai-frontend
    env: docker
    rootDir: callcenterai-frontend
    dockerfilePath: Dockerfile
    plan: free
    envVars:
      - key: VITE_API_URL
        fromService:
          type: web
          name: callcenterai-api
          property: host
